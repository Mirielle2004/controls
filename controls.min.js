/**
 * Name         : JoyStick.js
 * @author      : Mirielle S.
 * Last Modified: 2.11.2020
 * Revision     : 0.0.1
 * 
 * MIT License
 * 
 * Copyright (c) 2020 CodeBreaker
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 *  of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
class JoyStick{constructor(t="default"){if(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this._ctx=this.canvas.getContext("2d"),this.styles={dynamic:!0,pos:{x:0,y:0},dynamic:!0,innerRadius:15,color:"lightgray",outlineColor:"#222",lineWidth:4,outerRadius:50,backgroundColor:"none",backgroundOutlineColor:"#222",backgroundLineWidth:4,timeOut:100,floatRange:"window",showVector:!1},this.canvas.width=2*this.styles.outerRadius+this.styles.innerRadius+20,this.canvas.height=2*this.styles.outerRadius+this.styles.innerRadius+20,this.canvas.style.left=this.styles.pos.x+"%",this.canvas.style.top=this.styles.pos.y+"vh",this._origin={x:this.canvas.width/2,y:this.canvas.height/2},this._throwtle={x:this._origin.x,y:this._origin.y},this.isActive=!1,this.isDisplay=!this.styles.dynamic,this.isFading=!1,this.alpha=1,this.timeSpan=this.styles.timeOut||100,this.timeSpanCounter=this.timeSpan,this.onStart=null,this.onActive=null,this.onMove=null,this.onEnd=null,this.data={angle:0,direction:"static",length:0,mouse:null,touch:null},document.body.appendChild(this.canvas),void 0!==t)switch(t.toLowerCase()){case"touch":this.touch();break;case"mouse":this.mouse();break;case"default":"ontouchstart"in window?this.touch():"onmousedown"in window&&this.mouse();break;default:console.error(`${t} controller does not exists`)}else"ontouchstart"in window?this.touch():"onmousedown"in window&&this.mouse()}setStyle(t,i){this.styles.hasOwnProperty(t)&&(this.styles[t]=i),this.canvas.width=2*this.styles.outerRadius+this.styles.innerRadius+20,this.canvas.height=2*this.styles.outerRadius+this.styles.innerRadius+20,this.canvas.style.left=this.styles.pos.x+"%",this.canvas.style.top=this.styles.pos.y+"vh"}setStyles(t){for(const i in t)this.styles.hasOwnProperty(i)&&(this.styles[i]=t[i]);this.canvas.width=2*this.styles.outerRadius+this.styles.innerRadius+20,this.canvas.height=2*this.styles.outerRadius+this.styles.innerRadius+20,this.canvas.style.left=this.styles.pos.x+"%",this.canvas.style.top=this.styles.pos.y+"vh"}draw(){let t=this.styles;t.origin,t.pos;this._ctx.save(),this._ctx.globalAlpha=this.alpha,t.showVector&&(this._ctx.beginPath(),this._ctx.moveTo(this._origin.x,this._origin.y),this._ctx.lineTo(this._throwtle.x,this._throwtle.y),this._ctx.closePath(),this._ctx.strokeStyle="green",this._ctx.stroke()),this._draw(this._origin.x,this._origin.y,t.outerRadius,t.backgroundColor,t.backgroundOutlineColor,t.backgroundLineWidth),this._draw(this._throwtle.x,this._throwtle.y,t.innerRadius,t.color,t.outlineColor,t.lineWidth),this._ctx.restore()}mouse(){let t=this.styles;window.addEventListener("mousedown",i=>{t.dynamic&&(this.data.mouse=i,this.clientX=i.clientX-this.canvas.width/2,this.clientY=i.clientY-this.canvas.height/2,this.isActive=!0,"function"==typeof this.onStart&&this.onStart(),this.isActive&&(this.isDisplay=!0,this.isFading=!1,this.alpha=1,this.isActive=!0,this.canvas.style.left=this.clientX+"px",this.canvas.style.top=this.clientY+"px"))}),this.canvas.addEventListener("mousedown",i=>{if(!t.dynamic){this.data.mouse=i;let s=this.canvas.getBoundingClientRect(),e={x:i.clientX-s.left,y:i.clientY-s.top},h={x:this.canvas.width/2-e.x,y:this.canvas.height/2-e.y};Math.hypot(h.x,h.y);Math.hypot(h.x,h.y)<t.innerRadius&&(this.isActive=!0,"function"==typeof this.onStart&&this.onStart())}}),window.addEventListener("mousemove",t=>{let i=this.canvas.getBoundingClientRect(),s={x:t.clientX-i.left-this._origin.x,y:t.clientY-i.top-this._origin.y};if(this.isActive){let t=Math.hypot(s.x,s.y),i=Math.min(t,this.styles.outerRadius),e=Math.atan2(s.y,s.x);this._throwtle={x:this._origin.x+Math.cos(e)*i,y:this._origin.y+Math.sin(e)*i},this.data={angle:e,direction:"none",length:t},"function"==typeof this.onMove&&this.onMove()}}),window.addEventListener("mouseup",i=>{this._throwtle={x:this._origin.x,y:this._origin.y},this.data={angle:0,direction:"none",length:0},t.dynamic&&(this.isFading=!0),this.isActive&&("function"==typeof this.onEnd&&this.onEnd(),this.isActive=!1)})}touch(){let t=this.styles;window.addEventListener("touchstart",i=>{t.dynamic&&(this.data.touch=i,this.clientX=i.touches[0].pageX-this.canvas.width/2,this.clientY=i.touches[0].pageY-this.canvas.height/2,this.isActive=!0,"function"==typeof this.onStart&&this.onStart(),this.isActive&&(this.isDisplay=!0,this.isFading=!1,this.alpha=1,this.isActive=!0,this.canvas.style.left=this.clientX+"px",this.canvas.style.top=this.clientY+"px"))}),this.canvas.addEventListener("touchstart",i=>{this.data.touch=i;let s=this.canvas.getBoundingClientRect();if(!t.dynamic){let e={x:i.touches[0].pageX-s.left,y:i.touches[0].pageY-s.top},h={x:this.canvas.width/2-e.x,y:this.canvas.height/2-e.y};Math.hypot(h.x,h.y);Math.hypot(h.x,h.y)<t.innerRadius&&(this.isActive=!0,"function"==typeof this.onStart&&this.onStart())}}),window.addEventListener("touchmove",t=>{let i=this.canvas.getBoundingClientRect(),s={x:t.touches[0].pageX-i.left-this._origin.x,y:t.touches[0].pageY-i.top-this._origin.y};if(this.isActive){let t=Math.hypot(s.x,s.y),i=Math.min(t,this.styles.outerRadius),e=Math.atan2(s.y,s.x);this._throwtle={x:this._origin.x+Math.cos(e)*i,y:this._origin.y+Math.sin(e)*i},this.data={angle:e,direction:"none",length:t},"function"==typeof this.onMove&&this.onMove()}}),window.addEventListener("touchend",i=>{this._throwtle={x:this._origin.x,y:this._origin.y},this.data={angle:0,direction:"none",length:0},t.dynamic&&(this.isFading=!0),this.isActive&&("function"==typeof this.onEnd&&this.onEnd(),this.isActive=!1)})}animate(t,i){requestAnimationFrame(function s(){t.clearRect(0,0,t.canvas.width,t.canvas.height),i(),requestAnimationFrame(s)})}init(){this.animate(this._ctx,()=>{this.show()})}fadeIn(){this.isFading&&(this.timeSpanCounter-=1,this.alpha=Math.abs(this.timeSpanCounter/this.timeSpan),this.alpha<=0&&(this.isDisplay=!1,this.isFading=!1,this.timeSpanCounter=this.timeSpan))}show(){this.styles.dynamic?this.fadeIn():(this.isDisplay=!0,this.isFading=!1,this.alpha=1),this.isDisplay&&this.draw()}_draw(t,i,s,e,h,n=0){this._ctx.save(),this._ctx.lineWidth=n,this._ctx.strokeStyle=h||e,this._ctx.fillStyle=e,this._ctx.beginPath(),this._ctx.arc(t,i,s,0,2*Math.PI),this._ctx.closePath(),"none"!==h&&""!==h&&this._ctx.stroke(),void 0!==e&&"none"!==e&&""!==e&&this._ctx.fill(),this._ctx.restore()}}
